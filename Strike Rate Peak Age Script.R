# Install dependencies needed for scripting

library(dplyr)
library(tidyr)
library(ggstatsplot)
library(ggplot2)
library(ggthemes)

# Pull players from API to dual dataset

playerid <- 
  ODI_Ids %>%
  select(ID)
View(playerid)

# Pull players from API to dual dataset

battingData<- data.frame()

playerid = c(384525,54728,43707,43701,43697,43692,53904,53803,53817,53794,53813,53811,53795,53814,53826,53825,533956,320284,307653,55217,55219,55213,274175,54391,54389,543488,54493,37103,54390,233823,37235,54569,54397,54341,439029,54405,438263,54536,54410,232998,54542,54421,37602,54419,54570,54403,37714,54416,312174,37703,54414,544428,54434,54430,329003,54429,54452,274958,54408,54439,274569,543550,38252,54432,54485,54441,54445,54444,54443,54438,38608,380929,54459,38745,697885,54239,53913,442048,54237,54236,883423,54235,54234,54246,54279,54245,220679,54254,54240,372319,54242,54253,54044,53948,54248,54251,709635,961107,54082,442205,960815,54256,54259,54216,54258,597820,54262,490624,597806,54284,263980,54277,54276,220729,630972,54056,54270,490627,597811,54046,220680,883405,54081,442145,54035,360401,53919,442050,597821,54165,883413,372242,709837,39020,915489,54983,220665,220663,725879,346679,572645,38989,941805,38966,38964,55019,572638,54984,40383,55023,55024,361850,55055,55103,41262,41264,41263,54992,761027,333355,54998,54997,42062,941803,272324,361854,42044,276711,500733,362356,55009,55017,42647,220670,361841,220668,55000,317157,55001,361982,55007,55025,220673,43271,55013,55104,43539,54742,54840,54768,225579,54778,54831,54765,54748,371194,48803,54783,335241,54817,54754,54759,54854,631609,318853,54770,54750,631722,54785,340004,54744,54761,493715,318759,557839,335236,54767,49849,430391,272623,54780,54763,54842,434844,54850,429180,54738,54746,493860,332543,54821,54781,54752,335242,631721,370040,54836,442310,235519,427178,55150,527656,53740,53891,53727,53754,53752,53750,53747,53744,53758,53757,53788,53908,53786,53785,53783,300028,53776,53766,53775,53763,53770,53769,53833,53831,53829,53792,53859,53857,53856,53855,53854,53849,53847,53705,53837,53861,53881,53808,53875,53868,53867,53487,53485,53406,53404,53636,53477,53625,53483,374934,53489,53635,381217,53594,53418,53498,53638,53682,53665,381266,53608,53674,53499,53598,53430,53513,53508,53507,53599,275486,53424,858809,268889,381268,53620,53505,53544,53520,53643,374936,53516,53538,53472,53514,53446,53534,53523,53531,53532,53521,53600,53685,53527,53541,53550,53559,53455,275483,53558,53604,53606,53564,53563,420314,53605,53576,53575,53573,53587,53586,53578,53584,381305,946057,54572,8449,54571,54600,54630,317161,939249,54574,478278,54576,387270,593936,698189,498874,499254,54580,54579,54578,45828,364368,499354,387261,593963,487007,54582,351841,629578,54584,54583,364361,54631,54599,503123,54585,939229,453370,387959,54597,54592,364360,54640,54595,922481,55113,55112,55111,355348,55108,51228,55117,424629,474191,424631,55115,55119,370132,386563,55123,55121,355351,55125,55189,55124,55131,55148,55128,51870,52197,55132,474190,530811,55135,55172,55134,55133,472977,472975,355352,55137,472353,55136,474201,55140,315594,55144,355355,472347,820351,530139,677081,52960,55157,55155,55154,424630,355357,55152,355356
)
for(i in playerid)  {
  playerInfo <- cricketdata::fetch_player_data(i, "odi")
  playerInfo$id <- i
  battingData <- rbind(battingData, playerInfo)
}

YOB <- ODI_Ids %>% select("ID","YOB")

battingData <- inner_join(battingData,YOB, by = c("id"="ID"))

View(battingData)

# Turn into year not start-date

library(lubridate)
date <- c(battingData$Start_Date)
battingData$yearofgame <- year(as.Date(date,"%d,%m,%Y"))
battingData$age <- battingData$yearofgame-as.numeric(battingData$YOB)
View(battingData)

# Mutate, create strike rate as numeric value and grab peak ages

battingData$Strike_Rate <- as.numeric(battingData$SR)
newbattingData <- na.omit(battingData)
newbattingData <- newbattingData %>% 
  group_by(id, age) %>% 
  mutate(av = sum(Strike_Rate)/n()) %>% 
  group_by(id) %>% 
  mutate(maxAv = max(av)) %>% 
  filter(av == maxAv) %>% 
  select(id, age) %>% 
  group_by(id, age) %>% 
  summarise()
View(newbattingData)


# Plot 

ggplot(newbattingData, aes(x = newbattingData$age)) +
         geom_histogram(aes(y=..density..), colour="black", fill="white")+
  geom_density(alpha=.2, fill="#FF6666")+
  theme_economist()+
  xlab("Age at Peak Strike Rate")+
  ggtitle("Distribution of Age at Peak Strike Rate (All Male ODI Data)")
      
# Alternative Plot
        
ggplot(newbattingData, aes(x = newbattingData$age)) +
  geom_histogram()+
  geom_vline(aes(xintercept=median(age)),
             color="blue", linetype="dashed", size=1)+
  theme_economist()+
  xlab("Age at Peak Strike Rate")+
  ggtitle("Distribution of Age at Peak Strike Rate (All Male ODI Data)")       
         
         
         
      