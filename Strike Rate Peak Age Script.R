# Install dependencies needed for scripting

library(dplyr)
library(tidyr)
library(ggstatsplot)
library(ggplot2)

# Pull players from API to dual dataset

playerid <- 
  cricket_data %>%
  select(ID)
View(playerid)

# Pull players from API to dual dataset

battingData<- data.frame()

playerid = c(53824,17130,17121,17119,17111,24598,53904,17048,17045,21499,251721,16370,17025,16360,17018,53817,16337,16328,16331,15917,15913,16324,16993,358259,15910,16318,16956,16293,16287,16274,16271,16262,16933,16260,15876,53698,16925,15866,53810,53795,249934,16899,16207,16203,16891,16885,236489,17944,16178,16172,16871,53885,16862,53814,16857,18021,53702,8588,53897,8581,8579,8576,8566,8565,8608,8535,8532,8845,8526,8515,8513,8917,18389,18256,8480,308967,9327,398778,53906,9263,9259,9255,9252,9233,10617,9230,53891,53820,9223,9310,9208,9203,9187,9181,9163,9158,10582,9142,9136,9134,9099,53895,53738,9062,9057,9042,9037,9014,662973,9000,8998,8996,8992,53734,8982,10881,232438,53731,10870,10866,10864,10862,297433,8944,10846,10839,53752,10816,10797,10793,11728,53693,11718,10777,53691,10772,10754,53747,10705,53744,10666,10656,10653,10633,11951,53762,11946,53760,11931,11927,11914,53758,11893,11886,11883,11875,11870,14334,14327,14325,11865,11848,14286,53687,14254,14240,14236,53786,53785,14225,14222,14220,14189,53724,14187,53887,13492,13491,14159,14158,53800,13489,53726,14152,12543,14135,14133,14127,14119,13463,12518,12514,12930,53709,12507,14106,12923,12918,12909,13434,53696,12492,12490,53763,12486,12884,12881,12879,12877,13424,12875,13418,13411,12466,364788,12860,53707,12856,13399,14054,12854,14042,14041,13381,210283,13372,12835,13368,14024,13365,14022,12828,13357,13347,12812,12807,13340,249866,12803,13992,18640,18675,18627,18616,53834,15572,53833,288992,15555,15547,15399,18557,19264,15534,53831,53830,15383,15385,15381,53793,18536,19296,15509,440780,15495,15485,15481,18489,18488,18487,53704,15463,18475,18435,18428,18426,20436,20431,18411,20413,18655,20404,20406,20393,20387,53859,20385,229954,311158,20381,53857,20376,20372,20369,53855,20345,20350,20341,53854,20317,20316,53849,53729,20282,53721,20263,20255,19503,19500,19497,20240,20233,20231,53689,19478,20217,303669,19469,20198,272485,19445,53842,20187,19450,20179,19423,20159,20137,20126,19389,19386,20123,19394,20115,19376,19374,19299,20102,19365,20076,19352,19350,19346,244497,19331,19327,20058,53845,19323,53844,19316,20051,21644,21636,21634,21614,21611,21607,21600,47623,21585,21650,21548,21537,21528,21512,53862,53861,297635,249935,53715,21494,53713,21466,21464,21462,22545,22536,22526,22520,22518,22492,351588,22498,247235,22462,22442,53874,22408,22403,53870,53869,53868,22340,53867,22329,22322,22288,22290,22283,22149,22146,22192,296597,22185,22182,23534,23521)

for(i in playerid)  {
  playerInfo <- cricketdata::fetch_player_data(i, "odi")
  playerInfo$id <- i
  battingData <- rbind(battingData, playerInfo)
}

YOB <- cricket_data %>% select("ID","YOB")

battingData <- inner_join(battingData,YOB, by = c("id"="ID"))

View(battingData)

# Turn into year not start-date

library(lubridate)
date <- c(battingData$Start_Date)
battingData$yearofgame <- year(as.Date(date,"%d,%m,%Y"))
battingData$age <- battingData$yearofgame-as.numeric(battingData$YOB)
View(battingData)

# Mutate, create strike rate as numeric value and grab peak ages

battingData$Strike_Rate <- as.numeric(battingData$SR)
newbattingData <- na.omit(battingData)
newbattingData <- newbattingData %>% 
  group_by(id, age) %>% 
  mutate(av = sum(Strike_Rate)/n()) %>% 
  group_by(id) %>% 
  mutate(maxAv = max(av)) %>% 
  filter(av == maxAv) %>% 
  select(id, age) %>% 
  group_by(id, age) %>% 
  summarise()
View(newbattingData)


# Plot 

ggstatsplot::gghistostats(
  data = newbattingData, # dataframe from which variable is to be taken
  x = age, # numeric variable whose distribution is of interest
  title = "Distribution of Age at Peak Strike Rate - (All England Test Match Data - 1950-2019)", # title for the plot
  fill.gradient = TRUE, # use color gradient
  type = "bf",
  normal.curve = TRUE,
  normal.curve.color = "red",
  xlab = "Age at Peak Strike Rate", # bayes factor for one sample t-test
  bf.prior = 0.8, # prior width for calculating the bayes factor
  messages = FALSE # turn off the messages
)


